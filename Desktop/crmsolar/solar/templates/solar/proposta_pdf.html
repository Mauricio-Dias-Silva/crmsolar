<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Proposta Comercial - {{ projeto.nome }}</title>
    <style>
        /* CONFIGURA√á√ÉO DE FONTES E P√ÅGINA */
        @page {
            size: A4;
            margin: 2cm;
            @top-center { content: "Proposta SolarHub | Projeto: {{ projeto.nome }}"; font-size: 8pt; color: #888; }
            @bottom-center { content: "P√°gina " counter(page) " de " counter(pages); font-size: 8pt; color: #888; }
        }

        body { 
            font-family: sans-serif; 
            font-size: 10pt; 
            line-height: 1.5;
            color: #333;
        }
        
        /* ESTILOS DE CABE√áALHO */
        .header {
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }
        .header h1 { 
            color: #007bff;
            font-size: 18pt; 
            margin: 0;
        }
        .data { 
            font-size: 9pt; 
            text-align: right; 
            color: #555;
        }

        /* SE√á√ïES E BLOCOS */
        .section { 
            margin-top: 30px; 
            border: 1px solid #eee; 
            padding: 20px; 
            border-radius: 5px;
        }
        .section h2 {
            font-size: 14pt;
            color: #007bff;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .destaque { 
            font-weight: bold; 
            color: #34A853; /* Verde Solar */
            font-size: 11pt;
        }
        .box-valor {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            border-radius: 4px;
        }
        .box-valor p { margin: 5px 0; font-size: 12pt; }
        .box-valor .label { font-size: 9pt; color: #6c757d; }
    </style>
</head>
<body>

    <div class="header">
        <h1>Proposta T√©cnica e Comercial</h1>
        <p class="data">Gerado em: {{ data_atual|date:"d/m/Y H:i" }}</p>
    </div>
    
    {# ---------------------------------------------------------------- #}
    {# SE√á√ÉO 1: DETALHES GERAIS E CLIENTE #}
    {# ---------------------------------------------------------------- #}
    <div class="section">
        <h2>1. Detalhes do Cliente e Projeto</h2>
        
        <p><strong>Cliente:</strong> {{ projeto.cliente.nome_completo }}</p>
        <p><strong>Respons√°vel:</strong> {{ projeto.nome }}</p>
        <p><strong>Localiza√ß√£o da Instala√ß√£o:</strong> {{ projeto.endereco }}, {{ projeto.cidade }} - {{ projeto.estado }}</p>
        <p><strong>Status do Projeto:</strong> {{ projeto.status }}</p>
    </div>


    {# ---------------------------------------------------------------- #}
    {# SE√á√ÉO 2: AN√ÅLISE T√âCNICA E C√ÅLCULO #}
    {# ---------------------------------------------------------------- #}
    <div class="section">
        <h2>2. An√°lise T√©cnica e Gera√ß√£o Estimada</h2>
        
        <p>A viabilidade do seu projeto √© determinada pela irradia√ß√£o solar na sua regi√£o e pelo dimensionamento t√©cnico:</p>
        
        <ul>
            <li><strong>Pot√™ncia do Sistema (kWp):</strong> {{ projeto.potencia_kwp }} kWp</li>
            <li><strong>M√≥dulos/Inversor:</strong> {{ projeto.quantidade_modulos }} m√≥dulos | Inversor: {{ projeto.inversor }}</li>
            <li><strong>Irradia√ß√£o M√©dia Di√°ria (PVGIS):</strong> <span class="destaque">{{ irradiacao_media_diaria }} kWh/m¬≤/dia</span></li>
            <li><strong>√Çngulos de Instala√ß√£o:</strong> Inclina√ß√£o de {{ projeto.inclinacao_telhado }}¬∞ e Azimute de {{ projeto.azimute_telhado }}¬∞</li>
        </ul>
    </div>


    {# ---------------------------------------------------------------- #}
    {# SE√á√ÉO 3: RETORNO FINANCEIRO E GR√ÅFICO #}
    {# ---------------------------------------------------------------- #}
    <div class="section" style="break-after: page;">
        <h2>3. Proje√ß√£o de Retorno e Payback</h2>
        
        <div style="display: flex; justify-content: space-around; width: 100%; margin-bottom: 20px;">
            <div class="box-valor" style="width: 48%;">
                <p class="label">Economia Mensal Estimada</p>
                <p style="font-size: 16pt;">R$ <span class="destaque">{{ economia_mensal|floatformat:2 }}</span></p>
            </div>
            <div class="box-valor" style="width: 48%;">
                <p class="label">Payback Estimado (Retorno do Investimento)</p>
                <p style="font-size: 16pt;"><span class="destaque">{{ payback_anos }}</span> Anos</p>
            </div>
        </div>

        {# üí° INCORPORA√á√ÉO DO GR√ÅFICO MATPLOTLIB (Base64) #}
        {% if grafico_base64 %}
            <div style="margin-top: 30px; text-align: center;">
                <p><strong>Proje√ß√£o de Economia Acumulada em R$:</strong></p>
                <img src="data:image/png;base64,{{ grafico_base64 }}" style="width: 90%; max-width: 650px;">
            </div>
        {% endif %}

    </div>
    
    
    {# ---------------------------------------------------------------- #}
    {# SE√á√ÉO 4: TEXTO PERSUASIVO IA (Se a chave API estiver ok) #}
    {# ---------------------------------------------------------------- #}
    {% if texto_persuasivo_ia %}
        <div class="section" style="background-color: #f0fff0; border-color: #34A853;">
            <h2>4. Vantagem Competitiva: Seu Investimento</h2>
            {# O texto da IA √© injetado aqui #}
            <p style="font-style: italic; color: #1e7040;">{{ texto_persuasivo_ia }}</p>
        </div>
    {% endif %}

    {# ---------------------------------------------------------------- #}
    {# SE√á√ÉO 5: INFORMA√á√ïES COMERCIAIS E PAGAMENTO #}
    {# ---------------------------------------------------------------- #}
    <div class="section">
        <h2>5. Investimento e Condi√ß√µes</h2>
        
        <p style="font-size: 14pt; margin-top: 20px;"><strong>Valor Total do Sistema:</strong> <span class="destaque" style="font-size: 16pt;">R$ {{ projeto.valor_total|floatformat:2 }}</span></p>
        
        <hr>
        
        <p><strong>Forma de Pagamento Sugerida:</strong> {{ projeto.forma_pagamento }}</p>
        <p><strong>Fornecedor Principal:</strong> {{ projeto.fornecedor }}</p>
        
        <h3 style="font-size: 12pt; margin-top: 20px; color: #555;">Pr√≥ximos Passos:</h3>
        <ol>
            <li>Aceite da Proposta e Assinatura do Contrato.</li>
            <li>In√≠cio do Processo de Homologa√ß√£o junto √† concession√°ria.</li>
            <li>Aquisi√ß√£o dos Equipamentos e Agendamento da Instala√ß√£o.</li>
        </ol>
    </div>

</body>
</html>