{% extends 'solar/base.html' %} {# Ou o nome do seu template base #}

{% block content %}
<div class="container mt-4">
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0">Gerenciamento de Propostas</h2>
        </div>
        <div class="card-body">
            <p>Aqui você pode visualizar e acompanhar todas as propostas oficiais geradas.</p>

            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Cliente</th>
                            <th>Projeto Vinculado</th>
                            <th>Valor Total (R$)</th>
                            <th>Status</th>
                            <th>Data de Validade</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for proposta in propostas %}
                        <tr>
                            <td>
                                <a href="{% url 'crm:detalhe_proposta' proposta.pk %}"><strong>{{ proposta.numero }}</strong></a>
                            </td>
                            <td>{{ proposta.cliente_nome }}</td>
                            <td>
                                <a href="{% url 'crm:detalhe_projeto' proposta.projeto.pk %}">{{ proposta.projeto.nome }}</a>
                            </td>
                            <td>R$ {{ proposta.valor_total|floatformat:2 }}</td>
                            <td>
                                {% if 'AGUARDANDO' in proposta.get_status_crm_display|upper %}
                                    <span class="badge bg-warning">{{ proposta.get_status_crm_display }}</span>
                                {% elif 'ATIVO' in proposta.get_status_crm_display|upper or 'FINALIZADO' in proposta.get_status_crm_display|upper %}
                                    <span class="badge bg-success">{{ proposta.get_status_crm_display }}</span>
                                {% else %}
                                    <span class="badge bg-info">{{ proposta.get_status_crm_display }}</span>
                                {% endif %}
                            </td>
                            <td>{{ proposta.data_validade|date:"d/m/Y" }}</td>
                            <td>
                                <a href="{% url 'crm:detalhe_proposta' proposta.pk %}" class="btn btn-primary btn-sm">
                                    <i class="fas fa-eye"></i> Detalhes
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" class="text-center">Nenhuma proposta oficial encontrada.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}